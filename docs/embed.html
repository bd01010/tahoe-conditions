<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tahoe Conditions Widget</title>
</head>
<body>
<p>Copy this code to embed on your site:</p>
<hr>

<!-- START EMBED CODE -->
<style>
.tahoe-table { width: 100%; border-collapse: collapse; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 14px; }
.tahoe-table th { background: #1e3a5f; color: white; padding: 10px; text-align: left; }
.tahoe-table td { padding: 10px; border-bottom: 1px solid #e0e0e0; }
.tahoe-table tr:hover { background: #f5f5f5; }
.tahoe-open { color: #16a34a; font-weight: 600; }
.tahoe-closed { color: #dc2626; font-weight: 600; }
.tahoe-resort { font-weight: 600; }
.tahoe-updated { font-size: 12px; color: #666; margin-top: 8px; }
</style>

<div id="tahoe-conditions-widget">Loading Tahoe conditions...</div>

<script>
(function() {
  const API = 'https://bd01010.github.io/tahoe-conditions/data/latest.json';
  const SUMMARY = 'https://bd01010.github.io/tahoe-conditions/data/summary.json';

  Promise.all([fetch(API), fetch(SUMMARY)])
    .then(([r1, r2]) => Promise.all([r1.json(), r2.json()]))
    .then(([resorts, summary]) => {
      let html = `<table class="tahoe-table">
        <thead><tr>
          <th>Resort</th>
          <th>Lifts</th>
          <th>Trails</th>
          <th>New Snow</th>
          <th>Temp</th>
        </tr></thead><tbody>`;

      resorts.forEach(r => {
        const isOpen = r.ops.lifts_open > 0;
        const status = isOpen ? 'tahoe-open' : 'tahoe-closed';
        const lifts = r.ops.lifts_open !== null ? r.ops.lifts_open + '/' + r.ops.lifts_total : '-';
        const trails = r.ops.trails_open !== null ? r.ops.trails_open + '/' + r.ops.trails_total : '-';
        const snow = r.snow.new_snow_24h_in !== null ? r.snow.new_snow_24h_in + '"' : '-';
        const temp = r.weather.temp_f !== null ? r.weather.temp_f + 'Â°F' : '-';

        html += '<tr>';
        html += '<td class="tahoe-resort ' + status + '">' + r.name + '</td>';
        html += '<td>' + lifts + '</td>';
        html += '<td>' + trails + '</td>';
        html += '<td>' + snow + '</td>';
        html += '<td>' + temp + '</td>';
        html += '</tr>';
      });

      html += '</tbody></table>';
      html += '<p class="tahoe-updated">Updated: ' + new Date(summary.last_updated_utc).toLocaleString() + '</p>';

      document.getElementById('tahoe-conditions-widget').innerHTML = html;
    })
    .catch(() => {
      document.getElementById('tahoe-conditions-widget').innerHTML = 'Unable to load conditions';
    });
})();
</script>
<!-- END EMBED CODE -->

</body>
</html>
